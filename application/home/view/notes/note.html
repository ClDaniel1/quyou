{extend name="public/base"}
{block name='style'}
<!--页面样式、引用/示例如下-->
<link rel="stylesheet" href="__STATIC__/lib/jcrop/css/jquery.Jcrop.css">
<style>
    #aspectration[data-ratio="9:3"] {
        padding-top:33.33%;
        position: relative;
    }
    #aspectration img{
        float: left;
        width: 100%;
    }
    #aspectration span{
        position: absolute;
        width: 100%;
        top:45%;
        left: 0;
    }
    #aspectration div{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        text-align: center;
        color: #101010;
        font-size: 35px;
    }
    #aspectration i{
        font-size: 35px;
    }
    #imgView{
        position: fixed;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        z-index: 1000;
        display: none;
        text-align: center;
    }
    #imgView div{
        display: inline-block;

    }
    #imgView>img{
        display: inline-block;
        max-width: 90%;
        max-height: 90%;
    }
    #btn{
        margin-top: 1%;
        display: block!important;
    }
    #title{
        padding: 25px 0;
        text-align: center;
    }
    #title input{
        display: inline-block;
        width: 75%;
    }
</style>
{/block}

{block name='title'}
写游记—— 趣游
{/block}
{block name='first'}
<div id="imgView">
    <img id="imgShow" src="">
    <div id='btn'>
        <input type="button" value="提交" class="layui-btn navBg" id="subBI">
        <input type="button" value="取消" class="layui-btn navBg" id="escBI">
    </div>

</div>
{/block}

{block name='body'}
<!--页面内容 /示例如下-->


<div class="layui-upload">
    <button type="button" class="layui-btn" id="aspectration" data-ratio="9:3" style="width: 100%;background: gainsboro">
        <div>
            <span><i class="layui-icon"></i>上传头图</span>
        </div>
    </button>
</div>

<div id="title">

        <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入游记标题" class="layui-input">

</div>





    {/block}


{block name='script'}
<!--JS、引用 /示例如下-->
<script src="__STATIC__/lib/jcrop/js/jquery.Jcrop.js"></script>
<script>
    var upload = layui.upload;
    var jcropApi;

    //执行实例
    upload.render({
        elem: '#aspectration'
        ,url: '{:url("home/Notes/setUp")}'
        ,auto: false
        ,accept:"imgaes"
        ,number:1
        //,multiple: true
        ,bindAction: '#subBI'
        ,bgOpacity:0.1
        ,choose: function(obj){
            //预读本地文件示例，不支持ie8
            obj.preview(function(index, file, result){
                $('#imgShow').attr('src', result); //图片链接（base64）
                $("#imgView").fadeIn(300,function () {

                    $('#imgShow').Jcrop({
                        allowSelect:false,
                        aspectRatio:3/1
                    }, function() {
                        jcropApi = this;
                    });
                    var size = jcropApi.getBounds();

                    jcropApi.setOptions({
                        setSelect:[0,0,size[0],size[0]/3],
                        boxWidth:"1000"
                    })
                });
            });
        }
        ,before:function () {
            var select = jcropApi.tellSelect();
            var size = jcropApi.getBounds();
            console.log(select);
            var data = [size[0],select["x"],select["y"],select["x2"],select["y2"]];
            $.ajax({
                url: '{:url("home/Notes/setUp")}',
                data:{"size":JSON.stringify(data)},
                async:false
            })
        }
        ,done: function(res){
            if(res.code == 5001){
                $("#aspectration div").empty();
                $img = "<img src='/quyou/public/static/"+res.data.src+"?"+Math.random()+"'/>";
                $("#aspectration div").append($img);

                layer.msg("上传成功");
                $("#imgView").fadeOut(300,function () {
                    jcropApi.destroy();
                })
            }
        }
    });

    $("#escBI").click(function () {

        $("#imgView").fadeOut(300,function () {
            jcropApi.destroy();
        })
    })

</script>
{/block}